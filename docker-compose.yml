version: '3.8'

services:
  nginx-rtmp:
    image: tiangolo/nginx-rtmp
    ports:
      - "1935:1935"  # RTMP port
      - "8080:80"    # HTTP port for nginx
    volumes:
      - ./temp/rtmp:/var/recordings
    environment:
      - NGINX_RTMP_MODULE=on

  fastapi:
    build: .
    ports:
      - "8000:8000"
    volumes:
      - ./temp:/app/temp
      - ./.env:/app/.env
    depends_on:
      - nginx-rtmp
    environment:
      - RTMP_CALLBACK_URL=http://fastapi:8000/rtmp_callback
